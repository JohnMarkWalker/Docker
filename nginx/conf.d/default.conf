upstream backend {                                        # define an upstream (LB pool) #
  server mynginx1:80;                                         # backend 1 by name on webnet #
  server myapache1:80;                                         # backend 2 by name on webnet #
}                                                         # end upstream #
server {                                                  # server block #
  listen 80;                                              # listen on port 80 #
  location / {                                            # default location #
    proxy_pass http://backend;                            # reverse proxy to upstream #
    proxy_set_header Host $host;                          # preserve host header #
    proxy_set_header X-Real-IP $remote_addr;              # pass client IP #
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # proxy chain #
    proxy_set_header X-Forwarded-Proto $scheme;           # proto header #
  }                                                       # end location #
  location /healthz {                                     # simple health endpoint #
    return 200 "ok\n";                                    # return 200 OK #
    add_header Content-Type text/plain;                   # set content type #
  }                                                       # end health location #
}                                                         # end server #
EOF